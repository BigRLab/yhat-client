machine:
  environment:
    PATH: /home/ubuntu/miniconda2/bin:$PATH

dependencies:
  pre:
    - apt-get install -y s3cmd git
    # Get rid of existing virtualenvs on circle ci as they conflict with conda.
    # Trick found here:
    # https://discuss.circleci.com/t/disable-autodetection-of-project-or-application-of-python-venv/235/10
    - cd && rm -rf ~/.pyenv && rm -rf ~/virtualenvs
    - git clone --depth 1 https://github.com/conda/conda-build && cd conda-build && python setup.py install
    - pip install filelock

  override:
    # Moving to nilearn directory before performing the installation.
    - cd ~/yhat-client
    - source ci/install.sh
    - ci/create-env.sh 2.7
    - python setup.py install
    - ci/create-env.sh 3.5
    - python setup.py install

test:
  override:
    - source activate test-env-27 && python tests/test_yhat_json.py
    - source activate test-env-35 && python tests/test_yhat_json.py
